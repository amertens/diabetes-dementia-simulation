rm(list=ls())
library(here)
source(here::here("0_config.R"))
gc()
d_wide_list <- readRDS(file=here("data/null_simulated_data_list_subsampled.RDS"))
source(here::here("0_config.R"))
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/synthesizeDD.R"))
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/synthesizeDD.R"))
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/functions/0_synthesizeDD.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/functions/0_synthesizeDD.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
cc <- fread(paste0(here::here(),"/data/coefficients.txt"))
u <- synthesizeDD(cc)
calc_sim_truth
set.seed(12345)
sim_list <- NULL
n<-200
N_time=10
#calc truth
sim_truth <- calc_sim_truth(cc)
cRD <- sim_truth$cRD
cRR <- sim_truth$cRR
cRD
cRR
set.seed(12345)
sim_list <- NULL
n<-200
N_time=10
for(i in 1:n){
cat("\ni: ",i,"\n")
d <- sim(u,115698)
d$dem_prev <-    mean(1*(d$event_dementia_1 +
d$event_dementia_2 +
d$event_dementia_3 +
d$event_dementia_4 +
d$event_dementia_5 +
d$event_dementia_6 +
d$event_dementia_7 +
d$event_dementia_8 +
d$event_dementia_9 +
d$event_dementia_10 >0))
d<- clean_sim_data(d, N_time = 10)
sim_list[[i]] <- d
gc()
}
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/functions/0_synthesizeDD.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
cc <- fread(paste0(here::here(),"/data/coefficients.txt"))
u <- synthesizeDD(cc)
set.seed(12345)
sim_list <- NULL
n<-200
N_time=10
for(i in 1:n){
cat("\ni: ",i,"\n")
d <- sim(u,115698)
d$dem_prev <-    mean(1*(d$event_dementia_1 +
d$event_dementia_2 +
d$event_dementia_3 +
d$event_dementia_4 +
d$event_dementia_5 +
d$event_dementia_6 +
d$event_dementia_7 +
d$event_dementia_8 +
d$event_dementia_9 +
d$event_dementia_10 >0))
d<- clean_sim_data(d, N_time = 10)
sim_list[[i]] <- d
gc()
}
saveRDS(sim_list, paste0(here::here(),"/data/simulated_data_list.RDS"))
rm(list=ls())
library(lava)
library(data.table)
source(paste0(here::here(),"/functions/0_synthesizeDD.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
sim_list <- readRDS(paste0(here::here(),"/data/simulated_data_list.RDS"))
sim_list_null<-list()
for(i in 1:length(sim_list)){
d <- sim_list[[i]]
Y <- d %>% select(starts_with("event_")|starts_with("censor_"))
set.seed(123)
Y <- Y[sample(nrow(Y)),]
d <- d %>% select(!starts_with("event_")&!starts_with("censor_"))
d <- bind_cols(d, Y)
sim_list_null[[i]] <- d
}
saveRDS(sim_list_null, paste0(here::here(),"/data/simulated_data_list_old_null.RDS"))
rm(list=ls())
source(here::here("0_config.R"))
rm(list=ls())
source(here::here("0_config.R"))
rm(list=ls())
source(here::here("0_config.R"))
source(paste0(here::here(),"0_config.R"))
source(paste0(here::here(),"/0_config.R"))
source("~/diabetes-dementia-simulation/0_config.R", echo=TRUE)
source("~/diabetes-dementia-simulation/0_config.R", echo=TRUE)
#load functions
source(paste0(here::here(),"/functions/0_diabetes_dementia_functions.R"))
source("~/diabetes-dementia-simulation/0_config.R", echo=TRUE)
rm(list=ls())
source(paste0(here::here(),"/0_config.R"))
source(paste0(here::here(),"/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
source(paste0(here::here(),"/functions/0_simulation_cleaning_functions.R"))
cc <- fread(paste0(here::here(),"/data/coefficients.txt"))
source("~/diabetes-dementia-simulation/simulation_protective/calculate_truth.R", echo=TRUE)
rm(list=ls())
library(here)
source(here::here("0_config.R"))
source(paste0(here::here(),"/0_ltmle_Estimate_update.R"))
rm(list=ls())
library(here)
source(here::here("0_config.R"))
source(paste0(here::here(),"/functions/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
library(parallel)
library(doParallel)
registerDoParallel(cores=64)
d_wide_list <- readRDS(file=here("data/simulated_data_list_null.RDS"))
rm(list=ls())
library(here)
source(paste0(here::here(),"0_config.R"))
rm(list=ls())
library(here)
source(paste0(here::here(),"/0_config.R"))
source(paste0(here::here(),"/functions/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
library(parallel)
library(doParallel)
registerDoParallel(cores=64)
d_wide_list <- readRDS(file=here("data/simulated_data_list_null.RDS"))
rm(list=ls())
library(here)
source(paste0(here::here(),"/0_config.R"))
source(paste0(here::here(),"/functions/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
library(parallel)
library(doParallel)
registerDoParallel(cores=64)
d_wide_list <- readRDS(file=paste0(here::here(),"data/simulated_data_list_null.RDS"))
rm(list=ls())
library(here)
source(paste0(here::here(),"/0_config.R"))
source(paste0(here::here(),"/functions/0_ltmle_Estimate_update.R"))
source(paste0(here::here(),"/functions/0_simulation_functions.R"))
library(parallel)
library(doParallel)
registerDoParallel(cores=64)
d_wide_list <- readRDS(file=paste0(here::here(),"data/simulated_data_list_null.RDS"))
d_wide_list <- readRDS(file=paste0(here::here(),"/data/simulated_data_list_null.RDS"))
d_wide_list <- d_wide_list[1:200]
gc()
#--------------------------------------------------------------------------
# GLM
#--------------------------------------------------------------------------
resdf_noDetQ_ic_glm <- foreach(i = 1:length(d_wide_list), .combine = 'bind_rows', .errorhandling = 'remove') %dopar% {
res <- NULL
try(res <- run_ltmle_glmnet(d_wide_list[[i]], resdf=NULL, Qint=FALSE, det.Q=FALSE, varmethod = "ic",N_time=11, SL.library="glm"))
return(res)
}
